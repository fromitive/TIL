---
tags:
  - "#infra"
description: 마이그레이션 상세 과정 공유(초안)
---
## 마이그레이션 하게 된 이유

우아한테크코스 교육이 종료됨에 따라 aws 사용 기한이 만료됨. 구축한 인프라가 삭제되기 전에 마이그레이션 작업을 진행하기함

## 마이그레이션 방법

* AWS
    * 장점 : 구축하기 편함. VPC, SG(Security Group), EC2, rds를  그대로 구축하고 그에 맞게 `application.yml`, `application.properties` 파일의 설정값만 변경하면 뚝딱. aws계정도 공용계정 혹은 IAM으로 개별 설정하면 여러 사람이 한 번에 관리할 수 있음. AZ가 나눌 수 있도록 구축할 수 있어 하나 장애가 발생해도 가용성에 문제가 되지 않음(하지만 둘 다 박살난다면?) s3, rds등 고가용 스토리지를 편하게 설정할 수 있음. 나중에 다른 인프라 구성으로 변경할 때 유연하게 변경할 수 있음
    
    * 단점 : 우아한테크코스 시절 인프라 비용이 월 50달러임을 고려할 때 한 달에 과금 폭탄이 날라갈 수 있음. 해킹이나 과도한 트래픽이 발생할 때 비용폭탄이 나올 수 있음...

* 온프레미스
    * 장점 : 가지고 있는 데스크탑을 계속 서버로 사용하여 트래픽 비용 폭탄 맞을 걱정 없음. 비용은 전기세, 인터넷 비용만 나감
    * 단점: 서버를 항상 켜놓아야 함, 가상 OS라 인프라 추가가 AWS에 비해 오래걸림, S3, RDS와 같은 고가용성 인프라를 직접 구축해야 함, 인프라 구축이 aws에 비해 고정적임

결국엔 온프레미스를 선택하였는데, 이유는 아래와 같음


> VPC, SG(Security Group), EC2, rds를  그대로 구축하고 그에 맞게 `application.yml`, `application.properties` 파일의 설정값만 변경하면 뚝딱

`application.yml`과, `application.properties`가 생각보다 유연하여 aws를 사용하지 않고도 구축할 수 있음 특히 prod 서버는 read, write db를 분리해놓았는데 이부분도 사실 read, write db를 같은 아이피로 하여 구축해도 상관 없음

>  한 달에 과금 폭탄이 날라갈 수 있음. 해킹이나 과도한 트래픽이 발생할 때 비용폭탄이 나올 수 있음...

가장 큰 이유. aws를 사용하게 되면 늘 비용을 모니터링 해야하는데, 한번 해킹트레픽이 몰리면 답이 없는 상황이 나오는 것임. 유연하게 구축할 수 있는게 최대 장점이지만, 트래픽 폭탄맞으면 고객센터에 해명자료와 함께 설명해야하는게 귀찮아 짐. 이것에 시간을 할애하고 싶지 않았음

그렇다면 온프레미스는? 

>  S3, RDS와 같은 고가용성 인프라를 직접 구축해야 함, 인프라 구축이 aws에 비해 고정적임

온프레미스로 구성하게 되면 aws 의존적인 코드들을 추상화시켜 마이그레이션에 유연한 코드를 설계할 가능성이 있을 것이라 판단함. CI/CD 구성도 다시 해야하지만 변경 요소가 적을 것 같음. RDS 백업과 S3를 사용했던 이미지 서버를 어떻게 구축하느냐가 메인 퀘스트임

## 이미지 스토리지 변경

## MySQL 백업

## nginx prod CI/CD 변경

## DB 구축

### cloud-front 주소 이미지 주소로 변경

## 개발서버 구축

## 고민사항

* 개발 이미지 서버 vs Production 이미지 서버
* no-image.jpg 경로는 어떻게 지정할까?

